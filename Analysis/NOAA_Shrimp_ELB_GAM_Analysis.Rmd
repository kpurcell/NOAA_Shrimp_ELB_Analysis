NOAA Shrimp ELB Analaysis 
========================================================
Kevin Purcell
updated: 2013-12-4


This program runs the analysis for the Shrimp ELB analysis in a literate framework.  It was developed as a method to compare models and visualize them with JKC.  It is not being converted to an analysis script with a literate component.  

Data sources and inputs?  

The first chunk runs several scripts that gather the data from several files and formats.  In addition these scripts merge both the 1 week and 2 week data sets for examination with regression models.  This script depends on several packages which are also loaded in this chunk 1, see the ```sessionInfo()``` output for more details.  


```{r DataImport, echo=FALSE, results='hide', message=FALSE}
source("C:\\Users\\Kevin.Purcell\\Documents\\NOAA_Shrimp_ELB_Analysis\\Data\\GatherSource\\gatherData.R")
source("C:\\Users\\Kevin.Purcell\\Documents\\NOAA_Shrimp_ELB_Analysis\\Data\\merge2moData.R")
source("C:\\Users\\Kevin.Purcell\\Documents\\NOAA_Shrimp_ELB_Analysis\\Data\\merge1wkData.R")

# Dependent packages
library(mgcv)
library(maptools)
library(maps)
library(mapdata)
```


## Louisiana base model with 6 week data integration

```{r LAmodelinput, echo=FALSE}
gam.2mo.dur.la<-gam.2mo.dur.la[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","towhours","areaOB","cent_lon","cent_lat")]    
gam.2mo.dur.la<-na.omit(gam.2mo.dur.la)
```

```{r LAmodels, echo=TRUE}
m.2mo.dur.la<-gam(log(towhours+1) ~ factor(yr) + la_fuel_price + hrs +
                  + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                  s(cent_lon,cent_lat, by=do),
                  data=gam.2mo.dur.la)

nspm.2mo.dur.la<-gam(log(towhours+1) ~ factor(yr) + la_fuel_price  + hrs 
                     + s(do) + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat),
                     data=gam.2mo.dur.la)

```

```{r echo=FALSE, fig.align='center', fig.keep='none'}
gam.check(m.2mo.dur.la)
```

## model diagnostics look ok

```{r LAnspSummary, echo=FALSE}
summary(nspm.2mo.dur.la)
```
## LA non-spatial model results

```{r LAspSummary, echo=FALSE}
summary(m.2mo.dur.la)
```

## LA Spatial model results





The distribution of slopes for the coast of louisiana are heterogeneous and irregularly spread across the coast.  Area



```{r echo=FALSE, fig.align='center', fig.width=10, fig.height=10}
windows(width=12,height=10,record=T)
par(mfrow=c(2,1))
vis.gam(m.2mo.dur.la, view=c("cent_lon", "cent_lat"), 
        plot.type="contour", type="response", contour="black", cond=list(areaOB=7100),
        color="gray", n.grid=50, too.far=0.2,
        main="2009 = 7100 km^2 & 132902.06 hrs", ylab="Latitude", xlab="Longitude")
map("worldHires", fill=T, col="grey",add=T)
vis.gam(m.2mo.dur.la, view=c("cent_lon", "cent_lat"), 
        plot.type="contour", type="response", contour="black", cond=list(areaOB=22300),
        color="gray", n.grid=50, too.far=0.2,
        main="2008 = 22300 km^2 & 106886.31 hrs", ylab="Latitude", xlab="Longitude")
map("worldHires", fill=T, col="grey",add=T)


symbols(gam.2mo.dur.la$cent_lon[sign.slope.pos.do],gam.2mo.dur.la$cent_lat[sign.slope.pos.do],
        circle=pred.slope.do[sign.slope.pos.do],
        inches=0.15*max(range(pred.slope.do[sign.slope.pos.do]))/max.do,
        add=T,fg='white',bg='white')
symbols(gam.2mo.dur.la$cent_lon[sign.slope.neg.do],gam.2mo.dur.la$cent_lat[sign.slope.neg.do],
        circle=abs(pred.slope.do[sign.slope.neg.do]),
        inches=0.15*max(range(pred.slope.do[sign.slope.pos.do], finite=T))/max.do,
        add=T,fg='blue',bg='blue')
map("worldHires", fill=T, col="grey",add=T)
```


## Texas base model with 6 week data integration

```{r TXmodelInput, echo=FALSE}
gam.2mo.dur.tx<-gam.2mo.dur.tx[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","towhours","areaOB","cent_lon","cent_lat")]    
gam.2mo.dur.tx<-na.omit(gam.2mo.dur.tx)
```


```{r TXmodels, echo=TRUE}
m.2mo.dur.tx<-gam(log(towhours+1) ~ factor(yr) + la_fuel_price  + hrs 
                  + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                  s(cent_lon,cent_lat, by=do),
                  data=gam.2mo.dur.tx)

nspm.2mo.dur.tx<-gam(log(towhours+1) ~ factor(yr) + la_fuel_price  + hrs 
                     + s(do) + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat),
                     data=gam.2mo.dur.tx)
```


```{r echo=FALSE, fig.align='center'}
gam.check(m.2mo.dur.tx)
```

```{r echo=FALSE}
summary(m.2mo.dur.tx)
```


### Secondary Response variables

```{r echo=FALSE}
#####################################
# Louisiana tow count
gam.2mo.tow.count.la<-gam.2mo.tow.count.la[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","tow.cnt","areaOB","cent_lon","cent_lat")]    
gam.2mo.tow.count.la<-na.omit(gam.2mo.tow.count.la)
```

```{r echo=TRUE}
m.2mo.tow.count.la<-gam(tow.cnt ~ factor(yr) + la_fuel_price  + hrs   
                  + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                    s(cent_lon,cent_lat, by=do), family=poisson,
                  data=gam.2mo.tow.count.la)
```

gam.check(m.2mo.tow.count.la)
```{r}
summary(m.2mo.tow.count.la)
```




```{r echo=FALSE}
#########################################
# Texas tow count
gam.2mo.tow.count.tx<-gam.2mo.tow.count.tx[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","tow.cnt","cent_lon","cent_lat")]    
gam.2mo.tow.count.tx<-na.omit(gam.2mo.tow.count.tx)
```

```{r echo=TRUE}
m.2mo.tow.count.tx<-gam(tow.cnt ~ factor(yr) + la_fuel_price  + hrs   
                        + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                          s(cent_lon,cent_lat, by=do), family=poisson,
                        data=gam.2mo.tow.count.tx)
```


```{r echo=FALSE}
summary(m.2mo.tow.count.tx)
```



```{r echo=FALSE}
#############################################
# Louisiana Average Tow Duration
gam.2mo.avg.dur.la<-gam.2mo.avg.dur.la[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","avg.dur","cent_lon","cent_lat")]    
gam.2mo.avg.dur.la<-na.omit(gam.2mo.avg.dur.la)
```

```{r echo=TRUE}
m.2mo.avg.dur.la<-gam(avg.dur ~ factor(yr) + la_fuel_price  + hrs   
                        + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                          s(cent_lon,cent_lat, by=do), data=gam.2mo.avg.dur.la)

summary(m.2mo.avg.dur.la)

```



```{r echo=FALSE}
######################################
# Texas tow count
gam.2mo.avg.dur.tx<-gam.2mo.avg.dur.tx[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","avg.dur","cent_lon","cent_lat")]    
gam.2mo.avg.dur.tx<-na.omit(gam.2mo.avg.dur.tx)
```

```{r echo=TRUE}
m.2mo.avg.dur.tx<-gam(avg.dur ~ factor(yr) + la_fuel_price  + hrs   
                        + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                          s(cent_lon,cent_lat, by=do), 
                        data=gam.2mo.avg.dur.tx)

summary(m.2mo.avg.dur.tx)
```




Model effects for the Average Duration model


```{r}
sessionInfo()

#TODOs
# add sessioninfo() statement
# save RDATA file


