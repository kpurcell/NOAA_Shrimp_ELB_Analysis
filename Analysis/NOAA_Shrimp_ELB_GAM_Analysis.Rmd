NOAA Shrimp ELB Analaysis 
========================================================
Kevin Purcell
updated: 2013-12-4


This program runs the analysis for the Shrimp ELB analysis in a literate framework.  It was developed as a method to compare models and visualize them with JKC.  It is not being converted to an analysis script with a literate component.  

Data sources and inputs?  

The first chunk runs several scripts that gather the data from several files and formats.  In addition these scripts merge both the 1 week and 2 week data sets for examination with regression models.  This script depends on several packages which are also loaded in this chunk 1, see the ```sessionInfo()``` output for more details.  


```{r DataImport, echo=FALSE, results='hide', message=FALSE}
setwd("C:\\Users\\Kevin.Purcell\\Documents\\GitHub\\NOAA_Shrimp_ELB_Analysis")
source("C:\\Users\\Kevin.Purcell\\Documents\\GitHub\\NOAA_Shrimp_ELB_Analysis\\Data\\GatherSource\\gatherData.R")
source("C:\\Users\\Kevin.Purcell\\Documents\\GitHub\\NOAA_Shrimp_ELB_Analysis\\Data\\merge2moData.R")
source("C:\\Users\\Kevin.Purcell\\Documents\\GitHub\\NOAA_Shrimp_ELB_Analysis\\Data\\merge1wkData.R")

# Dependent packages
library(mgcv)
library(maptools)
library(maps)
library(mapdata)
```


## Louisiana base model with 6 week data integration

```{r LAmodelinput, echo=FALSE}
gam.2mo.dur.la<-gam.2mo.dur.la[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","towhours","areaOB","cent_lon","cent_lat")]    
gam.2mo.dur.la<-na.omit(gam.2mo.dur.la)
```

```{r LAmodels, echo=TRUE}
m.2mo.dur.la<-gam(log(towhours+1) ~ factor(yr) + la_fuel_price + hrs +
                  + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                  s(cent_lon,cent_lat, by=do),
                  data=gam.2mo.dur.la)

nspm.2mo.dur.la<-gam(log(towhours+1) ~ factor(yr) + la_fuel_price  + hrs 
                     + s(do) + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat),
                     data=gam.2mo.dur.la)

```

```{r echo=FALSE, fig.align='center', fig.keep='none'}
gam.check(m.2mo.dur.la)
```

### model diagnostics look ok

```{r LAnspSummary, echo=FALSE}
summary(nspm.2mo.dur.la)
```
### LA non-spatial model results

```{r LAspSummary, echo=FALSE}
summary(m.2mo.dur.la)
```

### LA Spatial model results


## Texas base model with 6 week data integration

```{r TXmodelInput, echo=FALSE}
gam.2mo.dur.tx<-gam.2mo.dur.tx[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","towhours","areaOB","cent_lon","cent_lat")]    
gam.2mo.dur.tx<-na.omit(gam.2mo.dur.tx)
```


```{r TXmodels, echo=TRUE}
m.2mo.dur.tx<-gam(log(towhours+1) ~ factor(yr) + la_fuel_price  + hrs 
                  + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                  s(cent_lon,cent_lat, by=do),
                  data=gam.2mo.dur.tx)

nspm.2mo.dur.tx<-gam(log(towhours+1) ~ factor(yr) + la_fuel_price  + hrs 
                     + s(do) + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat),
                     data=gam.2mo.dur.tx)
```


```{r echo=FALSE, fig.align='center'}
gam.check(m.2mo.dur.tx)
```

```{r echo=FALSE}
summary(m.2mo.dur.tx)
```


## Secondary Response variables

```{r echo=FALSE}
#####################################
# Louisiana tow count
gam.2mo.tow.count.la<-gam.2mo.tow.count.la[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","tow.cnt","areaOB","cent_lon","cent_lat")]    
gam.2mo.tow.count.la<-na.omit(gam.2mo.tow.count.la)
```

```{r echo=TRUE}
m.2mo.tow.count.la<-gam(tow.cnt ~ factor(yr) + la_fuel_price  + hrs   
                  + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                    s(cent_lon,cent_lat, by=do), family=poisson,
                  data=gam.2mo.tow.count.la)
```

```{r}
gam.check(m.2mo.tow.count.la)
```

```{r}
summary(m.2mo.tow.count.la)
```



```{r echo=FALSE}
#########################################
# Texas tow count
gam.2mo.tow.count.tx<-gam.2mo.tow.count.tx[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","tow.cnt","cent_lon","cent_lat")]    
gam.2mo.tow.count.tx<-na.omit(gam.2mo.tow.count.tx)
```


```{r echo=TRUE}
m.2mo.tow.count.tx<-gam(tow.cnt ~ factor(yr) + la_fuel_price  + hrs   
                        + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                          s(cent_lon,cent_lat, by=do), family=poisson,
                        data=gam.2mo.tow.count.tx)
```


```{r echo=FALSE}
summary(m.2mo.tow.count.tx)
```



```{r echo=FALSE}
#############################################
# Louisiana Average Tow Duration
gam.2mo.avg.dur.la<-gam.2mo.avg.dur.la[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","avg.dur","cent_lon","cent_lat")]    
gam.2mo.avg.dur.la<-na.omit(gam.2mo.avg.dur.la)
```

```{r echo=TRUE}
m.2mo.avg.dur.la<-gam(avg.dur ~ factor(yr) + la_fuel_price  + hrs   
                        + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                          s(cent_lon,cent_lat, by=do), data=gam.2mo.avg.dur.la)

summary(m.2mo.avg.dur.la)

```



```{r echo=FALSE}
######################################
# Texas tow count
gam.2mo.avg.dur.tx<-gam.2mo.avg.dur.tx[,c("yr","jd","hrs","do","depth", "ppnd", "la_fuel_price","avg.dur","cent_lon","cent_lat")]    
gam.2mo.avg.dur.tx<-na.omit(gam.2mo.avg.dur.tx)
```

```{r echo=TRUE}
m.2mo.avg.dur.tx<-gam(avg.dur ~ factor(yr) + la_fuel_price  + hrs   
                        + s(depth) + s(ppnd) + s(jd) + s(cent_lon,cent_lat) + 
                          s(cent_lon,cent_lat, by=do), 
                        data=gam.2mo.avg.dur.tx)

summary(m.2mo.avg.dur.tx)
```




Model effects for the Average Duration model

```{r MakeTables}
screenreg(list(nspm.2mo.dur.la,m.2mo.dur.la,nspm.2mo.dur.tx,m.2mo.dur.tx), 
               custom.model.names=c("NS-LA","SP-LA", "NS-TX", "SP-TX"),
               custom.coef.names=c("Intercept","2005","2006","2007","2008","2009",
                                   "2010", "Fuel Price", "Fishery Effort",
                                   "s(DO)","s(Depth)","s(Price)","s(Julian Day)",
                                   "s(Lon., Lat.)", "s(Lon.,Lat):DO"),
               single.row=TRUE)

sink("C:\\Users\\Kevin.Purcell\\Desktop\\test\\table1.tex")
texreg(list(nspm.2mo.dur.la,m.2mo.dur.la,nspm.2mo.dur.tx,m.2mo.dur.tx), 
               custom.model.names=c("NS-LA","SP-LA", "NS-TX", "SP-TX"),
               custom.coef.names=c("Intercept","2005","2006","2007","2008","2009",
                                   "2010", "Fuel Price", "Fishery Effort",
                                   "s(DO)","s(Depth)","s(Price)","s(Julian Day)",
                                   "s(Lon., Lat.)", "s(Lon.,Lat):DO"),
               single.row=TRUE,
               use.packages=TRUE)
unlink("C:\\Users\\Kevin.Purcell\\Destop\\test\\table1.tex")

```






```{r SessionSummary}
sessionInfo()
save.image(file=paste(Sys.Date(), ".RData", sep=""))
```


